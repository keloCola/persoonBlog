---
title: 设计原则
date: 2021-07-24 15:31:14
permalink: /pages/3b76ac/
categories:
  - 体系课程
  - js设计模式
tags:
  - 
---
# 第3章 设计原则

设计原则是理解设计模式的基础，是从设计到模式的过度。本章介绍何为设计，5大原则，另外，还会讲解两个关于面向对象与设计原则的真实面试题。
![](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724153908.png)
![image-20210724134951526](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724134951.png)


<!-- more -->
## 3-1~~3 设计原则

### 何为设计

- 描述
- 结合`《UNiX/Linux设计哲学》`有条件的买来自己看一下

### 描述

![image-20210724135224439](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724135224.png)

### 《UNiX/Linux设计哲学》

大概有10个设计准则

- 准则1：小即是美 —–甲壳虫车的例子
- 准则2：每个程序只做好一件事
- 准则3：快速建立原型—快速搭建可用的，然后再去迭代
- 准则4：舍弃高效率而取`可移植性`
- 准则5：采用`纯文本`来存储数据 —– `可读性`
- 准则6：充分利用软件的`杠杆效应`(软件复用)
- 准则7：使用`shell脚本`来提高杠杆效应和可移植性
- 准则8：避免强制性的用户界面—–所以Linux用的是命令行
- 准则9：让每个程序都称为过滤器
- 小准则
  - 允许用户定制环境
  - 尽量是操作系统内核小而轻量化
  - 使用小写字母并尽量简写
  - 沉默是金，输出一个数字，如果遇到不是一个数字，那输出就输个空或者0 
  - 各部分之和大于整体
  - `寻求90%的解决方案`—–100个人用解决90人的需求就行

### 演示：沉默是金+让每个程序成为过滤器

![image-20210724140646202](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724140646.png)

![image-20210724141058228](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724141058.png)

## 3-4~~3-5 设计原则-5大原则`SOLID`

![image-20210724141437639](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724141437.png)

### S-单一职责原则

- 一个程序值做好一件事
- 如果功能过于复杂就拆开来，每个部分保持`独立`

### O-开放封闭原则

- 对`扩展`开发，对`修改`封闭
- 增加需求时，`扩展`新代码，而`非修改`已有代码
- 这是软件设计的终极目标

### L-李氏置换原则

- 子类能覆盖父类
- 父类能出现的地方子类就能出现
- `JS中使用较少（弱类型&继承使用较少）`

### I-接口独立原则

- 保持接口的单一独立，避免出现“胖接口”
- `JS中没有接口（typescript例外），使用较少`
- 类似于单一职责原则，这里更关注接口

### D-依赖倒置原则

- 面向接口编程，`依赖于抽象`而不依赖于具体
- 使用方`只关注接口`而不关注具体类的实现
- `JS找那个使用较少（没有接口&弱类型）`

### 设计原则小结

- S O 体现较多，详细介绍
- L I D 体现较少，但是要了解其用意

### 用Promise来说明S O

```js
function loadImg(src) {
  let promise = new Promise(function (resolve, reject) {
    let img = document.createElement('img')
    img.onload = function () {
      resolve(img)
    }
    img.onerror = function () {
      reject('图片加载失败')
    }
    img.src = src
  })
  return promise
}

let src = ''
let result = loadImg(src)
result.then(function (img) {
  // part1
  alert(`width:${img.width}`)
  return img
}).then(function (img) {
  // part2
  alert(`height:${img.height}`)
}).catch(function (err) {
  alert(`err:${err}`)
})
```



![image-20210724142649035](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724142649.png)

## 3-6 设计模式简介

- 设计
- 模式
- 分开
- 从设计到模式

## 3-7 23种设计模式介绍

![23种设计模式](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724153853.png)

- 创建型
- 结构型
- 行为型（常用行为）


### 创建型
- 工厂模式（工厂方法模式，抽象工厂模式，建造者模式）
- 单例模式
  - 只有一个不能创建第二个怎么办
- 原型模式
  - 现有的对象，拷贝出来

### 结构型

- 适配器模式
- 装饰器模式
- 代理模式
- 外观模式
- 桥接模式
- 组合模式
- 享元模式

### 行为型

- 策略模式
- `迭代器模式`
- 模板方法模式
- `观察者模式`
- 职责连模式
- 命令模式
- 备忘录模式
- `状态模式`
- 访问者模式
- 中介者模式
- 解释器模式

### 如何讲解

![image-20210724144601089](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724144601.png)

### 如何学习

![image-20210724144713701](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724144713.png)



## 面试题示例

![image-20210724144951572](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724144951.png)

## 面试第一题，打车

### 题目

![image-20210724145042339](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724145042.png)

![image-20210724145105622](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724145105.png)

### 解题思路

::: details

- 首先车应该是父类，有车牌号和名称
- 专车和快车为子类，有价格1元 2 元
- 行程应该也是一个类，行车与车有，但是和专车和快车没什么关系
- 行程要引用父类车里面的信息，行程还拥有打车金额的信息

:::

### ULM类图

::: details

![image-20210724145812173](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724145812.png)

:::

### 代码实现

::: details

```js {21~23}
class Car {
  constructor(number, name) {
      this.number = number
      this.name = name
  }
}
class Kuaiche extends Car {
  constructor(number, name) {
      super(number, name)
      this.price = 1
  }
}
class Zhuanche extends Car {
  constructor(number, name) {
      super(number, name)
      this.price = 2
  }
}

class Trip {
  constructor(car) {
      this.car = car
  }
  start() {
      console.log(`行程开始，名称: ${this.car.name}, 车牌号: ${this.car.price}`)
  }
  end() {
      console.log('行程结束，价格: ' + (this.car.price * 5))
  }
}

let car = new Kuaiche(100, '桑塔纳')
let trip = new Trip(car)
trip.start()
trip.end()
```



:::

## 面试第二题-停车

### 题目

![image-20210724150458797](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724150458.png)

### 解题思路

::: details

- 先判断几个类，停车场，层数，车位，车辆
- 车辆（驶入方法，离开方法） 车位（空，飞空）
- 进入前，停车场（每层空位数量–>层）
- 进入是，摄像头（车牌号，时间）
- 出来时，显示器（车牌号，停车时长）

:::

### UML类图

::: details

![image-20210724151611235](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724151611.png)

:::

### 代码

::: details

```js
// 车
class Car {
    constructor(num) {
        this.num = num
    }
}

// 入口摄像头
class Camera {
    shot(car) {
        return {
            num: car.num,
            inTime: Date.now()
        }
    }
}

// 出口显示器
class Screen {
    show(car, inTime) {
        console.log('车牌号', car.num)
        console.log('停车时间', Date.now() - inTime)
    }
}

// 停车场
class Park {
    constructor(floors) {
        this.floors = floors || []
        this.camera = new Camera()
        this.screen = new Screen()
        this.carList = {}
    }
    in(car) {
        // 获取摄像头的信息：号码 时间
        const info = this.camera.shot(car)
        // 停到某个车位
        const i = parseInt(Math.random() * 100 % 100)
        const place = this.floors[0].places[i]
        place.in()
        info.place = place
        // 记录信息
        this.carList[car.num] = info
    }
    out(car) {
        // 获取信息
        const info = this.carList[car.num]
        const place = info.place
        place.out()

        // 显示时间
        this.screen.show(car, info.inTime)

        // 删除信息存储
        delete this.carList[car.num]
    }
    emptyNum() {
        return this.floors.map(floor => {
            return `${floor.index} 层还有 ${floor.emptyPlaceNum()} 个车位`
        }).join('\n')
    }
}

// 层
class Floor {
    constructor(index, places) {
        this.index = index
        this.places = places || []
    }
    emptyPlaceNum() {
        let num = 0
        this.places.forEach(p => {
            if (p.empty) {
                num = num + 1
            }
        })
        return num
    }
}

// 车位
class Place {
    constructor() {
        this.empty = true
    }
    in() {
        this.empty = false
    }
    out() {
        this.empty = true
    }
}

// 测试代码------------------------------
// 初始化停车场
const floors = []
for (let i = 0; i < 3; i++) {
    const places = []
    for (let j = 0; j < 100; j++) {
        places[j] = new Place()
    }
    floors[i] = new Floor(i + 1, places)
}
const park = new Park(floors)

// 初始化车辆
const car1 = new Car('A1')
const car2 = new Car('A2')
const car3 = new Car('A3')

console.log('第一辆车进入')
console.log(park.emptyNum())
park.in(car1)
console.log('第二辆车进入')
console.log(park.emptyNum())
park.in(car2)
console.log('第一辆车离开')
park.out(car1)
console.log('第二辆车离开')
park.out(car2)

console.log('第三辆车进入')
console.log(park.emptyNum())
park.in(car3)
console.log('第三辆车离开')
park.out(car3)
```

:::

## 3-13 总结

![image-20210724152945589](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724152945.png)


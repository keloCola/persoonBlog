---
title: 单例模式
date: 2021-07-25 23:08:37
permalink: /pages/b35cdb/
categories:
  - 体系课程
  - js设计模式
tags:
  - 
---
# 第5章 单例模式

单例模式的核心结构中只包含一个被称为单例的特殊类。概念、UML类图仍是必须，本章使用的场景是 jquery中只有一个$，redux 和 vuex 的 store，一个系统中只有一套登录逻辑

![image-20210724205154553](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724205228.png)

![image-20210724205850063](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724205850.png)
<!-- more -->
## 5-1 单例模式-介绍

- 系统中被唯一使用
- `一个类只有一个实例`

## 实例

- 登录框
- 购物车

## UML类图

### 传统UML类图 比如说java之类的

![image-20210724205810808](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724205811.png)

### 代码演示 由于需要用到java特性，故用java代码演示

![](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724205929.png)

![image-20210724210144292](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724210144.png)

![image-20210724210206516](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724210206.png)

## 5-2 js演示简单的单例模式

```js
class SingleObject {
    login() {
        console.log('login...')
    }
}
// 在class 上定义一个静态方法 getInstancce
SingleObject.getInstance = (function () {
    let instance
    // 使用闭包来模拟单例模式
    return function () {
        if (!instance) {
            // 不存在 就在内部实例化
            instance = new SingleObject();
        }
        return instance
    }
})()

// 测试
// 注意：这里只能使用静态函数 getInstance ，不能 new SingleObject（）！！！！
// 虽然那样浏览器不会报错，但根本不是我们要的
let obj1 = SingleObject.getInstance()
obj1.login()
let obj2 = SingleObject.getInstance()
obj2.login()
console.log(obj1 === obj2)//两者必须完全相等
```

```js
let obj3 = new SingleObject() // 无法控制
console.log(obj1 === obj2)//false
//并非同一个实例
```

:::tip

解释下静态方法，singleObject实例多次

```js {2,6}
class SingleObject {
    login() { 
        console.log('login...')
    }
}
SingleObject.getInstance = (function () {})()
```

login()会有多个      —–>动态方法

getInstance（）就一个 —–>静态方法

:::

## 5-3 单例模式场景

![image-20210724211626233](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210724211626.png)

### jQuery

如果有就直接用，没有就new一个

```js
//jquery 只有一个`$`
if(window.jQuery != null){
    return window.jQuery
}else{
    //...初始化
}
```

### 模拟登陆框

```js {23-33}
class LoginForm {
  constructor() {
      this.state = 'hide'//默认是隐藏的
  }
  show() {
      if (this.state === 'show') {
          alert('已经显示')
          return
      }
      this.state = 'show'
      console.log('登录框已显示')
  }
  hide() {
      if (this.state === 'hide') {
          alert('已经隐藏')
          return
      }
      this.state = 'hide'
      console.log('登录框已隐藏')
  }
}

// 自定义函数
LoginForm.getInstance = (function () {
  let instance
  // 获取单例的变量
  return function () {
      if (!instance) {
          instance = new LoginForm();
      }
      return instance
  }
})()

// 一个页面中调用登录框
let login1 = LoginForm.getInstance()
login1.show()
// login1.hide()

// 另一个页面中调用登录框
let login2 = LoginForm.getInstance()
login2.show()

// 两者是否相等
console.log('login1 === login2', login1 === login2)  //true
```

### 其他

- 购物车（和登录框类似）
- vuex 和 Redux中的`store`
  - 试想多个模块都要获取数据，如果不是同一个实例，那就实现不了数据共享了，可见vuex 和 redux 中的 store 单例模型

## 设计原则验证

- 符合单一职责原则，只实例化唯一的对象
- `没法`具体体现开放封闭原则，但是绝对不违反开放封闭原则
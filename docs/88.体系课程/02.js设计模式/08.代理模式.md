---
title: 代理模式
date: 2021-07-25 23:10:40
permalink: /pages/cef278/
categories:
  - 体系课程
  - js设计模式
tags:
  - 
---
# 第8章 代理模式

为其他对象提供一种代理以控制对这个对象的访问。网络代理，明星/经纪人的场景恰如其分

## 8-1 代理模式-介绍和演示

- 使用者无权访问目标对象
- 中间加代理，通过代理做授权和控制

比方说`科学上网`
<!-- more -->
![image-20210725014309556](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210725014309.png)

### 示例

- 科学上网，访问GitHub
- 明星经纪人

## 传统UML类图

![image-20210725014420841](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210725014421.png)

![image-20210725014503409](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210725014503.png)

## 简化后的UML类图

![image-20210725014545864](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210725014546.png)

## 代码

```js
class ReadImg{
  constructor(fileName){
    this.fileName=fileName
    this.loadFormDisk()//初始化 即从硬盘中加载 当然这里只是模拟的
  }
  display(){
    console.log('display...'+this.fileName);
  }
  loadFormDisk(){
    console.log('loading...'+this.fileName);
  }
}

class ProxyImg{
  constructor(fileName){
    this.realImg = new ReadImg(fileName)
  }
  display(){
    this.realImg.display()//直接去realImg这个类里去哪
  }
}

// 测试
let proxyImg = new ProxyImg('1.png')
proxyImg.display()
```

![image-20210725015405953](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210725015406.png)

## 8-2 代理模式-场景1(事件代理和jq的proxy)

![image-20210725015448381](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210725015448.png)

### 网页事件代理

```html {19}
<!DOCTYPE html>

<head>
  <title>Document</title>
</head>

<body>
  <div id='div1'>
    <a href="">1</a>
    <a href="">2</a>
    <a href="">3</a>
    <a href="">4</a>
    <a href="">5</a>
  </div>
</body>
<script>
  let div = document.getElementById('div1')
  div.addEventListener('click', function (e) {
    var target = e.target
    if (target.nodeName === 'A') {
      alert(target.innerHTML)
    }
  })
</script>

</html>
```

冒泡！

### $.proxy

![image-20210725020256599](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210725020256.png)

![image-20210725020408234](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210725020408.png)

```js
  /* jquery */
  $('div1').click(function(){
    var fn = function(){
      $(this).css('color','yellow')
    }
    fn = $.proxy(fn,this)//代理
    setTimeout(fn,1000)
  })
```



### ES6 Proxy

![image-20210725021132094](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210725021132.png)

## 8-3 代理模式-场景2(明星经纪人)

```js {29}
// 明星
let star = {
  name: '张XX',
  age: 25,
  phone: '13910733521'
}

// 经纪人
//  new Proxy(代理的对象，{})
let agent = new Proxy(star, {
  get: function (target, key) {
      if (key === 'phone') {
          // 返回经纪人自己的手机号
          return '18611112222'
      }
      if (key === 'price') {
          // 明星不报价，经纪人报价
          return 120000
      }
      return target[key]
  },
  set: function (target, key, val) {
      if (key === 'customPrice') {
          if (val < 100000) {
              // 最低 10w
              throw new Error('价格太低')
          } else {
              target[key] = val
              return true
          }
      }
  }
})

// 主办方
console.log(agent.name)
console.log(agent.age)
console.log(agent.phone)
console.log(agent.price)

// 想自己提供报价（砍价，或者高价争抢）
agent.customPrice = 150000
// agent.customPrice = 90000  // 报错：价格太低
console.log('customPrice', agent.customPrice)
```

## 设计原则验证

- 代理类和目标类分离，隔离开目标类和使用类
- 符合开放封闭原则

## 8-4 代理&适配器&装饰模式对比

### 代理模式VS适配器模式

![image-20210725022041565](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210725022041.png)

### 代理模式VS装饰器模式

![image-20210725022131396](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210725022131.png)


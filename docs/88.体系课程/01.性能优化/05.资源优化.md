---
title: 资源优化
date: 2021-07-23 17:34:46
permalink: /pages/54f888/
categories:
  - 体系课程
  - 性能优化
tags:
  - 
---
- 减少http请求数量
- 减少请求资源的大小

[[toc]]

<!-- more -->

# 1资源的压缩与合并

## HTML压缩

- 使用在线工具进行压缩
- 使用[html-minifier]("https://github.com/kangax/html-minifier")等npm工具
- 有一说一没有多大的空间去压缩

![image-20210723162418714](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210723162418.png)

## CSS压缩

- 使用在线工具进行压缩
- 使用clean-css等npm工具
- 实际上不用单独使用在这里面[html-minifier]("https://github.com/kangax/html-minifier")已经有涉及了

## JS压缩与混淆

- 使用webpack对js在构建时压缩

## CSS JS 文件合并

- 若干个资源合并成一个资源
- 争议还是很大的
- 若干个小文件，可能可以
- 无冲突，服务相同的模块，那是OK的
- `优化加载，no!` 现在推荐的是渐进式的加载，【拆分】
- 同时也会影响缓存，多个文件合成一个的时候，一旦有一小部分变化，整个缓存都要更新

#  2图片格式优化

## 图片优化的方案

- 格式
- 大小
- 适配不同屏幕的尺寸
- 压缩
- 加载优先级
- 延迟加载的技术
- 自动化解决方法 使用工具辅助

![image-20210723163305278](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210723163305.png)

## 图片格式比较

### jpg

jpg格式的优点

- 有损压缩，压缩比好，色彩还不错，很多人在使用
- 生成jpg或者压缩工具，[imagemin](https://github.com/imagemin/imagemin)
- [在线使用](https://www.doppler.com/?utm_campaign=github_repo&utm_medium=referral&utm_content=imagemin&utm_source=github)

jpg格式的使用场景

- 首屏轮播图
- 保证画质和色彩

jpg格式的缺陷

- 压缩比高，纹理图案之类的表现粗糙
- 一般logo不用

### png

png格式的优点

- 细腻程度相对较高

png格式的使用场景

- 小的图片，图标，
- 工具[imagemin-pngquant](https://github.com/imagemin/imagemin-pngquant)设置quality

png格式的缺点

- 体积更大

### webp

webp格式的优点

- png同样的质量
- 体积更小

webp格式的缺点

- 兼容性不高

![image-20210723164640558](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210723164640.png)

### svg

- 手机端用的比较多

# 3 图片加载优化

- 懒加载

## 图片的懒加载

- 原生的图片懒加载方案
  - img上加一个`loading='lazy'`属性 即`<img loading='lazy' src='' />`
- 第三方图片懒加载方案
  - [verlok/lazyload](https://github.com/verlok/vanilla-lazyload)
  - [yall.js]()
  - [Blazy]()

## 使用渐进式图片

![image-20210723165447823](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210723165448.png)

![image-20210723165521777](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210723165522.png)

## 渐进式图片的缺点

- 等待时间相对较长，但也要根据图片的大小

![image-20210723165759962](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210723165800.png)

## 渐进式图片的解决方案

- [progressive-image](https://github.com/craigbuckler/progressive-image.js)
- [ImageMagick](https://github.com/ImageMagick/ImageMagick)
- [libjpeg](https://github.com/libjpeg-turbo/libjpeg-turbo)
- [jpegtran]()
- [jpeg-recompress]()
- [imagemin]()

## 使用响应式图片

- scrset 属性的使用
- Size属性的使用
- picture的使用 并不是都支持的，通过scourse 进行源耳朵选择

![image-20210723165947868](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210723165948.png)

100w 200w 这些指的是屏幕宽度的大小来选择

![image-20210723170007837](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210723170007.png)

#  4 字体优化

## FOIT与FOUT

- 字体未下载完成时，浏览器隐藏或自动降级，导致字体闪烁
- Flash  Of Invisible Text 字体闪烁
- Flash of Unstyled Text 字体 样式未加载 会有一个变换过程 

## 使用font-display

![image-20210723170439171](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210723170439.png)

![image-20210723170455957](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210723170456.png)

- auto: 自动选择
- Block：先等待3s,没下载完就用默认的，直到下载完了，再显示web的
- Swap：直接使用默认的，字体下载完就立即切换
- FallBack ：先等待100ms, 没下载完就用默认的，直到下载完了，再显示web的
- Optional ： 针对手机端 准备100ms , 如果网络下载好了用web的，没有就默认的，不会切换

[看个例子](https://css-tricks.com/hey-hey-font-display/)

<video src="https://css-tricks.com/wp-content/uploads/2018/04/font-display.mov"></video>

## 引入字体

![image-20210723170815813](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210723170816.png)

```css
@font-face {
  font-family: 'Long Cang';
  font-style: normal;
  font-weight: 400;
  src:url(https://fonts.gstatic.com/s/longcang/v7/LYjAdGP8kkgoTec8zkRgqBgxXsWsMfnCm1_q1j3gcsptb8OMg_Z2HVZhDbPBCIyx.6.woff2) format('woff2');
    //字体拆分
  unicode-range: U+f0a7, U+f0b2, U+f0b7, U+f0c9, U+f0d8, U+f0da, U+f0dc-f0dd, U+f0e0, U+f0e6, U+f0eb, U+f0fc, U+f101, U+f104-f105, U+f107, U+f10b, U+f11b, U+f14b, U+f18a, U+f193, U+f1d6-f1d7, U+f244, U+f27a, U+f296, U+f2ae, U+f471, U+f4b3, U+f610-f611, U+f880-f881, U+f8ec, U+f8f5, U+f8ff, U+f901, U+f90a, U+f92c-f92d, U+f934, U+f937, U+f941, U+f965, U+f967, U+f969, U+f96b, U+f96f, U+f974, U+f978-f979, U+f97e, U+f981, U+f98a, U+f98e, U+f997, U+f99c, U+f9b2, U+f9b5, U+f9ba, U+f9be, U+f9ca, U+f9d0-f9d1, U+f9dd, U+f9e0-f9e1, U+f9e4, U+f9f7, U+fa00-fa01, U+fa08, U+fa0a, U+fa11, U+fb01-fb02, U+fdfc, U+fe0e, U+fe30-fe31, U+fe33-fe44, U+fe49-fe52, U+fe54-fe57, U+fe59-fe66, U+fe68-fe6b, U+fe8e, U+fe92-fe93, U+feae, U+feb8, U+fecb-fecc, U+fee0;
}
```

## 使用Ajax+base64

- 转换成base64 并嵌入
- 解决兼容性问题
- 缺点：缓存问题
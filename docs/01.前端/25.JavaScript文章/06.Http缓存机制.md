---
title: Http缓存机制
date: 2021-07-15 17:36:13
permalink: /pages/44ff1f/
categories:
  - 前端
  - JavaScript文章
tags:
  - 
---
# Http缓存机制

关于协商缓存和强缓存的

## Cache-Control的值

- max-age 设置缓存最大期限
- no-cache 不使用强制缓存
- no-store 不用本地缓存 不使用服务端缓存，直接重新返回一份
-  private 最终用户才能缓存
-  public 中间代理也能做缓存

## Expires

- 同在Response Headers中
- 同为控制缓存过期
- 已被Cache-Control代替

## 强缓存

- 初次请求 返回资源和Cache-Control
-  再次请求 本地资源直接返回资源
- 缓存失效 再次请求服务端

![](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210706110107.png)

## 协商缓存

- 服务端缓存策略（并不是缓存在服务端）
-  服务端判断客户端资源，是否和服务端资源一样
-  一致则返回304，否则返回200和最新的资源

![image-20210706110155961](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210706110156.png)



## 资源标识

- 在response headers 中有两种
- `Last-Modified`资源的最后修改时间
- `Etag`资源的唯一标识（一个字符串，类似于人类的指纹）

### Last-Modified

![image-20210706110254586](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210706110254.png)

### Etag

![image-20210706110309640](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210706110309.png)

## 总结

![image-20210706110341463](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210706110341.png)

- 强缓存（问都不问直接用）
  - `Expires` Expires:Thu,21 Jan 2021 17:24:40 GMT 【·表示绝对时间 服务器的时间 判断本地与服务器的时间】
  - `Cache-Control`: max-age=2592000             【表示相对时间 】
  - 两个都有的情况下 以`Cache-Control`为主
- 协商缓存（还要问一下服务器的好）
  - Last-Modified下发的  If-Modified-Since以这个字段 请求的
  - `last-modified`: Mon, 21 Jun 2021 09:55:40 GMT
  - Etag If-None-Match 可以理解为hash值

## 刷新对http缓存

- 正常操作：地址栏输入URL，跳转链接，前进后退等

-  手动刷新：F5，点击刷新按钮，右击菜单刷新 
  
- 强制刷新：ctrl+F5

- 正常操作：强制缓存有效，协商缓存有效

- 手动刷新：强制缓存失效，协商缓存有效

- 强制刷新：强制缓存失效，协商缓存失效


















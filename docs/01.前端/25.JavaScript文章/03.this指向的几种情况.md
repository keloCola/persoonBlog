---
title: this指向的几种情况
date: 2021-07-22 15:29:09
permalink: /pages/4861eb/
categories:
  - 前端
  - JavaScript文章
tags:
  - 真
---

[[toc]]

## 简单说一下

默认绑定：全局环境中，this默认绑定到window。

隐式绑定：一般地，被直接对象所包含的函数调用时，也称为方法调用，this隐式绑定到该直接对象。

隐式丢失：隐式丢失是指被隐式绑定的函数丢失绑定对象，从而默认绑定到window。显式绑定：通过call()、apply()、bind()方法把对象绑定到this上，叫做`显式绑定`。

new绑定：如果函数或者方法调用之前带有关键字new，它就构成构造函数调用。对于this绑定来说，称为new绑定。

- 构造函数通常不使用return关键字，它们通常初始化新对象，当构造函数的函数体执行完毕时，它会显式返回。在这种情况下，构造函数调用表达式的计算结果就是这个新对象的值。
- 如果构造函数使用return语句但没有指定返回值，或者返回一个原始值，那么这时将忽略返回值，同时使用这个新对象作为调用结果。
- 如果构造函数显式地使用return语句返回一个对象，那么调用表达式的值就是这个对象。

## `this` 只依赖于调⽤函数前的对象

```js
function foo() {
console.log(this.a)
}
var a = 1
foo()
var obj = {
a: 2,
foo: foo
}
obj.foo()
```

- 对于直接调⽤ foo 来说，不管 foo 函数被放在了什么地⽅， this ⼀定是window
- 对于 obj.foo() 来说，我们只需要记住，谁调⽤了函数，谁就是 this ，所以在这个场
  景下 foo 函数中的 this 就是 obj 对象

## `this` 只会绑定在实例 `c` 上，不会被任何⽅式修改 `this` 指向

```js
var c = new foo()
c.a = 3
console.log(c.a)
```

- 对于 new 的⽅式来说， this 被永远绑定在了 c 上⾯，不会被任何⽅式改变 this

## 利⽤ call，apply，bind 改变 this

```js
function foo() {
console.log(this.a)
}
foo().bind(this)
```

## 箭头函数中的this

```js
function a() {
  return () => {
    return () => {
      console.log(this)
    }
  }
}
console.log(a()()())
```

- ⾸先箭头函数其实是没有 this 的，箭头函数中的 this 只取决包裹箭头函数的第⼀个普通函数的 this 。在这个例⼦中，因为包裹箭头函数的第⼀个普通函数是 a ，所以此时的 this 是 window 。另外对箭头函数使⽤ bind 这类函数是⽆效的。

## 优先级总结

⾸先， `new `的⽅式优先级最⾼，接下来是 `bind `这些函数，然后是`obj.foo() `这种调⽤⽅式，最后是` foo `这种调⽤⽅式，同时，箭头函数的this ⼀旦被绑定，就不会再被任何⽅式所改变。
---
title: 事件轮询机制
date: 2021-07-15 17:36:13
permalink: /pages/f8ed20/
categories:
  - 前端
  - JavaScript文章
tags:
  - 
---
# 事件轮询机制

## 首先我们先不涉及微任务

- 同步代码,一行一行放在Call Stack执行
- 遇到异步， 会先“记录”下，等待时机(定时、网络请求等)
- 时机到了就移动到Callback Queue
- 如Call Stack为空(即同步代码执行完) Event Loop幵始工作
- 轮询査找Callback Queue，如有則移劫到Call Stack抗行
- 然后继续轮询查找(永劫机一样)

```
  onclick 由浏览器内核的 DOM Binding 模块来处理，当事件触发的时候，回调函数会立即添加到任务队列中。
　setTimeout 会由浏览器内核的 timer 模块来进行延时处理，当时间到达的时候，才会将回调函数添加到任务队列中。
　ajax 则会由浏览器内核的 network 模块来处理，在网络请求完成返回之后，才将回调添加到任务队列中。
```

举一个例子

```js
console.log('Hi')
setTimeOut(function cb1(){
    console.log('cb1')//cb === callback
},5000)
console.log('Bye')
```

![image-20210706104532342](https://gitee.com/sheep101/typora-img-save/raw/master/img/image-20210706104532342.png)

![image-20210706104625252](https://gitee.com/sheep101/typora-img-save/raw/master/img/image-20210706104625252.png)

![image-20210721161011814](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210721161011.png)

![image-20210721160947103](https://gitee.com/sheep101/typora-img-save/raw/master/img/20210721160947.png)

## 宏任务macroTask 和微任务 microTask

- 宏任务;settimeout , serInterval , ajax ,DOM 事件
- 微任务：`Promise` `async/await`
- 微任务执行机制比宏任务要早

### 宏任务

- script
- setTimeout
- setInterval
- setImmediate
- I/O
- UI rendering

### 微任务

- process.nextTick
- promise
- Object.observe
- MutationObserver



![image-20210706104745255](https://gitee.com/sheep101/typora-img-save/raw/master/img/image-20210706104745255.png)

![image-20210706104803100](https://gitee.com/sheep101/typora-img-save/raw/master/img/image-20210706104803100.png)

## 做一道题

```js
async function async1 () {
  console.log('async1 start')
  await async2()
  console.log('async1 end') 
}

async function async2 () {
  console.log('async2')
}

console.log('script start')

setTimeout(function () { 
  console.log('setTimeout')
}, 0)

async1()

new Promise (function (resolve) { 
  console.log('promise1')
  resolve()
}).then (function () {
  console.log('promise2')
})

console.log('script end')
```


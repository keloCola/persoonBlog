---
title: instanceof的原理
date: 2021-07-23 11:23:08
permalink: /pages/09b721/
categories:
  - 前端
  - JavaScript文章
tags:
  - 
---
##   instanceof 的原理 并用代码实现

- 知识点：如果A沿着原型链能找到B.prototype,那么A instanceof B 为 true

- 解法：遍历A的原型链，如果找到B.prototype 返回true 否则返回false

```js
const instanceOf = (A,B)=>{
  let p = A
  while(p){
    if(p===B.prototype){
      return true
    }
    p= p.__proto__
  }
  return false
}

```
## 手写instanceof 第二版
```js
/*
 * --- 手动实现 instanceof ---
 */

function newInstanceOf (leftValue, rightValue) {
    if (typeof leftValue !== 'object' || rightValue == null) { 
        return false;
    }
    
    let rightProto = rightValue.prototype;
    leftValue = leftValue.__proto__;
    
    while (true) {
        if (leftValue === null) return false;
        if (leftValue === rightProto) return true;
        leftValue = leftValue.__proto__;
    }
}

/*
 * --- 验证 ---
 */

const a = [];
const b = {};

function Foo () {}

var c = new Foo()
function Child () {}
function Father() {}
Child.prototype = new Father()
var d = new Child()

console.log(newInstanceOf(a, Array)) // true
console.log(newInstanceOf(b, Object)) // true
console.log(newInstanceOf(b, Array)) // false
console.log(newInstanceOf(a, Object)) // true
console.log(newInstanceOf(c, Foo)) // true
console.log(newInstanceOf(d, Child)) // true
console.log(newInstanceOf(d, Father)) // true
console.log(newInstanceOf(123, Object)) // false 
console.log(123 instanceof Object) // false
```